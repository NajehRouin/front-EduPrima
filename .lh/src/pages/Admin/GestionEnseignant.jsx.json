{
    "sourceFile": "src/pages/Admin/GestionEnseignant.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1748457459528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748457471456,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -250,5 +250,5 @@\n     </div>\r\n   );\r\n }\r\n \r\n-export default GestionEnseignant;\n\\ No newline at end of file\n+export default GestionEnseignant;\r\n"
                },
                {
                    "date": 1748470202911,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,8 +71,9 @@\n   };\r\n \r\n   const confirmDelete = () => {\r\n     // TODO: Implement delete logic\r\n+    console.log(\"enseignantToDelete\",enseignantToDelete?._id)\r\n     setShowDeleteModal(false);\r\n     setEnseignantToDelete(null);\r\n   };\r\n \r\n@@ -80,8 +81,9 @@\n     setShowDeleteModal(false);\r\n     setEnseignantToDelete(null);\r\n   };\r\n \r\n+\r\n   return (\r\n     <div className=\"p-4 h-screen overflow-y-auto\">\r\n       <h1 className=\"text-2xl font-bold mb-6 text-center\">\r\n         Liste des enseignants par classe\r\n"
                },
                {
                    "date": 1748470604912,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,10 @@\n import { FaEdit, FaTrash } from \"react-icons/fa\";\r\n import ApiEnseignant from \"../../Api/Enseignant\";\r\n import AjouterEnseignant from \"../../components/AjouterEnseignant\";\r\n import EditEnseignant from \"../../components/EditEnseignant\"; // Import the new component\r\n-\r\n+import { toast, ToastContainer } from \"react-toastify\";\r\n+import \"react-toastify/dist/ReactToastify.css\";\r\n const enseignantsParPage = 5;\r\n \r\n function GestionEnseignant() {\r\n   const [classes, setClasses] = useState([]);\r\n@@ -69,13 +70,30 @@\n     setEnseignantToDelete(enseignant);\r\n     setShowDeleteModal(true);\r\n   };\r\n \r\n-  const confirmDelete = () => {\r\n+  const confirmDelete = async() => {\r\n     // TODO: Implement delete logic\r\n-    console.log(\"enseignantToDelete\", enseignantToDelete?._id);\r\n-    setShowDeleteModal(false);\r\n-    //setEnseignantToDelete(null);\r\n+    const res = await fetch(ApiEnseignant.DeleteEnseignant.url, {\r\n+        method: ApiEnseignant.DeleteEnseignant.method,\r\n+        credentials: \"include\",\r\n+        headers: {\r\n+          \"Content-Type\": \"application/json\",\r\n+        },\r\n+          body: JSON.stringify({\r\n+        idEnseignant:enseignantToDelete?._id\r\n+      }),\r\n+      });\r\n+       const response = await res.json();\r\n+    if (response.success) {\r\n+       toast.success(response.message);\r\n+            fetchData();\r\n+ setShowDeleteModal(false);\r\n+    setEnseignantToDelete(null);\r\n+    } else {\r\n+          toast.error(response.message);\r\n+        }\r\n+   \r\n   };\r\n \r\n   const cancelDelete = () => {\r\n     setShowDeleteModal(false);\r\n"
                },
                {
                    "date": 1748470629395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,8 +100,9 @@\n   };\r\n \r\n   return (\r\n     <div className=\"p-4 h-screen overflow-y-auto\">\r\n+       <ToastContainer position=\"top-center\" />\r\n       <h1 className=\"text-2xl font-bold mb-6 text-center\">\r\n         Liste des enseignants par classe\r\n       </h1>\r\n \r\n"
                }
            ],
            "date": 1748457459528,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\r\nimport { FaEdit, FaTrash } from \"react-icons/fa\";\r\nimport ApiEnseignant from \"../../Api/Enseignant\";\r\nimport AjouterEnseignant from \"../../components/AjouterEnseignant\";\r\nimport EditEnseignant from \"../../components/EditEnseignant\"; // Import the new component\r\n\r\nconst enseignantsParPage = 5;\r\n\r\nfunction GestionEnseignant() {\r\n  const [classes, setClasses] = useState([]);\r\n  const [currentPages, setCurrentPages] = useState([]);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false); // State for edit modal\r\n  const [selectedClasse, setSelectedClasse] = useState(null);\r\n  const [selectedEnseignant, setSelectedEnseignant] = useState(null); // State for selected teacher\r\n  const [enseignantToDelete, setEnseignantToDelete] = useState(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      const res = await fetch(ApiEnseignant.getAllEnseignantByClasse.url, {\r\n        method: ApiEnseignant.getAllEnseignantByClasse.method,\r\n        credentials: \"include\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        const updated = data.result.map((classe) => ({\r\n          ...classe,\r\n          searchTerm: \"\",\r\n        }));\r\n        setClasses(updated);\r\n        setCurrentPages(new Array(data.result.length).fill(1));\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleSearchChange = (e, idx) => {\r\n    const updated = [...classes];\r\n    updated[idx].searchTerm = e.target.value;\r\n    setClasses(updated);\r\n  };\r\n\r\n  const handlePageChange = (idx, direction) => {\r\n    const newPages = [...currentPages];\r\n    newPages[idx] += direction;\r\n    setCurrentPages(newPages);\r\n  };\r\n\r\n  const openModal = (classe) => {\r\n    setSelectedClasse(classe);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const openEditModal = (enseignant) => {\r\n    setSelectedEnseignant(enseignant);\r\n    setIsEditModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteClick = (enseignant) => {\r\n    setEnseignantToDelete(enseignant);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  const confirmDelete = () => {\r\n    // TODO: Implement delete logic\r\n    setShowDeleteModal(false);\r\n    setEnseignantToDelete(null);\r\n  };\r\n\r\n  const cancelDelete = () => {\r\n    setShowDeleteModal(false);\r\n    setEnseignantToDelete(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 h-screen overflow-y-auto\">\r\n      <h1 className=\"text-2xl font-bold mb-6 text-center\">\r\n        Liste des enseignants par classe\r\n      </h1>\r\n\r\n      {classes.map((classe, idx) => {\r\n        const filtered = classe.enseignants.filter((ens) =>\r\n          ens.nom.toLowerCase().includes(classe.searchTerm?.toLowerCase() || \"\")\r\n        );\r\n\r\n        const indexOfLast = currentPages[idx] * enseignantsParPage;\r\n        const indexOfFirst = indexOfLast - enseignantsParPage;\r\n        const current = filtered.slice(indexOfFirst, indexOfLast);\r\n        const totalPages = Math.ceil(filtered.length / enseignantsParPage);\r\n\r\n        return (\r\n          <div key={idx} className=\"mb-10\">\r\n            <div className=\"flex items-center justify-between mb-3 flex-wrap gap-2\">\r\n              <h2 className=\"text-xl font-semibold text-blue-600\">\r\n                {classe.nomClasse} - {classe.niveau}\r\n              </h2>\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Rechercher un enseignant\"\r\n                  className=\"border p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n                  value={classe.searchTerm || \"\"}\r\n                  onChange={(e) => handleSearchChange(e, idx)}\r\n                />\r\n                <button\r\n                  onClick={() => openModal(classe)}\r\n                  className=\"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600\"\r\n                >\r\n                  Ajouter\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto rounded-lg shadow-md\">\r\n              <table className=\"min-w-full bg-white border border-gray-200\">\r\n                <thead className=\"bg-gray-100\">\r\n                  <tr>\r\n                    <th className=\"py-2 px-4 border-b text-center\">Nom</th>\r\n                    <th className=\"py-2 px-4 border-b text-center\">Email</th>\r\n                    <th className=\"py-2 px-4 border-b text-center\">\r\n                      Spécialité\r\n                    </th>\r\n                    <th className=\"py-2 px-4 border-b text-center\">Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {current.map((ens) => (\r\n                    <tr key={ens._id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"py-2 px-4 border-b text-center\">\r\n                        {ens.nom}\r\n                      </td>\r\n                      <td className=\"py-2 px-4 border-b text-center\">\r\n                        {ens.email}\r\n                      </td>\r\n                      <td className=\"py-2 px-4 border-b text-center\">\r\n                        {ens.specialite}\r\n                      </td>\r\n                      <td className=\"py-2 px-4 border-b text-center\">\r\n                        <div className=\"flex justify-center gap-4\">\r\n                          <button\r\n                            className=\"text-blue-500 hover:text-blue-700\"\r\n                            onClick={() => openEditModal(ens)}\r\n                          >\r\n                            <FaEdit />\r\n                          </button>\r\n                          <button\r\n                            className=\"text-red-500 hover:text-red-700\"\r\n                            onClick={() => handleDeleteClick(ens)}\r\n                          >\r\n                            <FaTrash />\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n\r\n                  {current.length === 0 && (\r\n                    <tr>\r\n                      <td\r\n                        colSpan=\"4\"\r\n                        className=\"py-4 text-center text-gray-400\"\r\n                      >\r\n                        Aucun enseignant trouvé.\r\n                      </td>\r\n                    </tr>\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            <div className=\"flex justify-center mt-4 gap-4\">\r\n              <button\r\n                onClick={() => handlePageChange(idx, -1)}\r\n                disabled={currentPages[idx] === 1 || totalPages === 0}\r\n                className=\"px-4 py-2 bg-gray-300 rounded-md disabled:opacity-50\"\r\n              >\r\n                Précédent\r\n              </button>\r\n              <span className=\"px-4 py-2\">\r\n                Page {totalPages === 0 ? 0 : currentPages[idx]} /{\" \"}\r\n                {totalPages || 1}\r\n              </span>\r\n              <button\r\n                onClick={() => handlePageChange(idx, 1)}\r\n                disabled={currentPages[idx] === totalPages || totalPages === 0}\r\n                className=\"px-4 py-2 bg-gray-300 rounded-md disabled:opacity-50\"\r\n              >\r\n                Suivant\r\n              </button>\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n\r\n      {/* Modal de suppression */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 bg-gray-700 bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white p-6 rounded-lg shadow-md w-80\">\r\n            <h2 className=\"text-xl font-semibold mb-4 text-center\">\r\n              Confirmer la suppression\r\n            </h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">\r\n              Supprimer {enseignantToDelete?.nom} ?\r\n            </p>\r\n            <div className=\"flex justify-around\">\r\n              <button\r\n                onClick={cancelDelete}\r\n                className=\"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400\"\r\n              >\r\n                Annuler\r\n              </button>\r\n              <button\r\n                onClick={confirmDelete}\r\n                className=\"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600\"\r\n              >\r\n                Supprimer\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Modal d'ajout */}\r\n      {isModalOpen && (\r\n        <AjouterEnseignant\r\n          fetchdata={fetchData}\r\n          isOpen={isModalOpen}\r\n          closeModal={() => setIsModalOpen(false)}\r\n          selectedClasse={selectedClasse}\r\n        />\r\n      )}\r\n\r\n      {/* Modal de modification */}\r\n      {isEditModalOpen && (\r\n        <EditEnseignant\r\n          fetchdata={fetchData}\r\n          isOpen={isEditModalOpen}\r\n          closeModal={() => setIsEditModalOpen(false)}\r\n          enseignantId={selectedEnseignant?._id}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default GestionEnseignant;"
        }
    ]
}